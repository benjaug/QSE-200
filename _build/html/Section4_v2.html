
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Section 4: Discrete Variable Representation &#8212; QSE 200 Sections</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script>window.MathJax = {"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}}</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Section 6: An Intuitive Picture of Band Structure" href="Section6_v2.html" />
    <link rel="prev" title="Welcome to QSE 200!" href="home.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">QSE 200 Sections</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="home.html">
                    Welcome to QSE 200!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Section 4: Discrete Variable Representation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Section6_v2.html">
   Section 6: An Intuitive Picture of Band Structure
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/benjaug/QSE-200/master?urlpath=tree/docs/Section4_v2.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/benjaug/QSE-200"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/benjaug/QSE-200/issues/new?title=Issue%20on%20page%20%2FSection4_v2.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/Section4_v2.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#motivating-the-sinc-basis-dvr">
   Motivating the Sinc-Basis DVR
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpreting-the-sinc-basis">
     Interpreting the Sinc-Basis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deriving-the-kinetic-energy-matrix">
   Deriving the Kinetic Energy Matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deriving-the-potential-energy-matrix">
   Deriving the Potential Energy Matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-the-dvr-code">
   Testing the DVR code
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparing-dvr-to-finite-differences">
     Comparing DVR to Finite Differences
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Section 4: Discrete Variable Representation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#motivating-the-sinc-basis-dvr">
   Motivating the Sinc-Basis DVR
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpreting-the-sinc-basis">
     Interpreting the Sinc-Basis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deriving-the-kinetic-energy-matrix">
   Deriving the Kinetic Energy Matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deriving-the-potential-energy-matrix">
   Deriving the Potential Energy Matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-the-dvr-code">
   Testing the DVR code
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparing-dvr-to-finite-differences">
     Comparing DVR to Finite Differences
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="section-4-discrete-variable-representation">
<h1>Section 4: Discrete Variable Representation<a class="headerlink" href="#section-4-discrete-variable-representation" title="Permalink to this headline">#</a></h1>
<p>Last week, we studied the connection between position and momentum space using Fourier transforms. We learned that we can work in either “position space” with basis states $\langle x’ | x \rangle = \delta(x-x’)$, or in “momentum space” with basis states $\langle k’ | k \rangle = \delta(k-k’)$. We also showed that these kets are connected by the relation</p>
<div class="amsmath math notranslate nohighlight" id="equation-3e903f6f-728b-4df2-9358-1b2011c57a21">
<span class="eqno">(1)<a class="headerlink" href="#equation-3e903f6f-728b-4df2-9358-1b2011c57a21" title="Permalink to this equation">#</a></span>\[\begin{equation}
\langle k | x \rangle = (2\pi)^{-1/2} e^{-i k x}.
\end{equation}\]</div>
<p>In this week’s section, we will use what we learned to build and solve matrix representations of the Hamiltonian for arbitrary 1D potentials using a method called the “Discerete Variable Representation” (DVR). This is a method that is widely used in physics and chemistry to solve for the states and energies of potential energy surfaces needed to describe molecular vibrations, chemical reactions, and beyond.</p>
<p><strong>Learning Goals:</strong>
After this Section you should be able to:</p>
<ul class="simple">
<li><p>Understand when it is more natural to work in a “position” vs. “momentum” basis</p></li>
<li><p>Use the sinc basis to express the Hamiltonian for an arbitrary 1D potential</p></li>
<li><p>Find the eigenvalues and eigenvectors of Hamiltonians for arbtirary potentials using the discrete variable representation</p></li>
</ul>
<section id="motivating-the-sinc-basis-dvr">
<h2>Motivating the Sinc-Basis DVR<a class="headerlink" href="#motivating-the-sinc-basis-dvr" title="Permalink to this headline">#</a></h2>
<p>As with previous problems, we’ll first introduce a grid of $N$ equally spaced points on the domain $[x_\text{min}, x_\text{max}]$. The points can be specified as</p>
<div class="amsmath math notranslate nohighlight" id="equation-616d9bf9-aae3-43d1-8b40-938f6620901f">
<span class="eqno">(2)<a class="headerlink" href="#equation-616d9bf9-aae3-43d1-8b40-938f6620901f" title="Permalink to this equation">#</a></span>\[\begin{equation}
x_j = x_\text{min} + (j-1) \Delta x
\end{equation}\]</div>
<p>where</p>
<div class="amsmath math notranslate nohighlight" id="equation-57a6a3a4-9bae-4237-bedf-7fdc1da1b650">
<span class="eqno">(3)<a class="headerlink" href="#equation-57a6a3a4-9bae-4237-bedf-7fdc1da1b650" title="Permalink to this equation">#</a></span>\[\begin{equation}
\Delta x = \frac{x_\text{max} - x_\text{min}}{N-1}.
\end{equation}\]</div>
<p>Next, we want to set up some basis ${|\phi_i\rangle}$ that allows us to express our wavefunction as a superposition of convenient basis functions. Putting this into math based on last week’s section, we want a way to implement the expansion</p>
<div class="amsmath math notranslate nohighlight" id="equation-30ad070c-8150-4527-a63c-24fdb9c310b5">
<span class="eqno">(4)<a class="headerlink" href="#equation-30ad070c-8150-4527-a63c-24fdb9c310b5" title="Permalink to this equation">#</a></span>\[\begin{equation}
\psi(x) = \langle x | \psi \rangle = \sum_{i=1}^{n} c_i \langle x | \phi_i \rangle = \sum_{i=1}^{n} c_i \phi_i(x).
\end{equation}\]</div>
<p>There are many possible reasonable choices of this basis, and there is a vast literature of DVR methods that use different choices (some that can’t even be written as nice analytical functions!). But let’s think about what we would want in a general DVR basis set.</p>
<p><strong>Question: What nice properties might we want?</strong></p>
<p><strong>Answer:</strong> Some example of useful properties would be:</p>
<ul class="simple">
<li><p>We want the basis to satisfy $\langle x_i | x_j \rangle \propto \delta_{i,j}$</p></li>
<li><p>It would be nice if the basis functions were “well behaved” so that we can evaluate derivatives, Fourier transforms, etc.</p></li>
</ul>
<p>One example of a set of functions that satisfy these desiderata are the <em>sinc functions</em>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-80aa6e3c-bbf0-496b-82c8-0d0abc89c53e">
<span class="eqno">(5)<a class="headerlink" href="#equation-80aa6e3c-bbf0-496b-82c8-0d0abc89c53e" title="Permalink to this equation">#</a></span>\[\begin{equation}
\phi_j(x) = \frac{1}{\sqrt{\Delta x}} \frac{\sin[\pi (x-x_j)/\Delta x]}{\pi (x-x_j)/\Delta x} = \frac{1}{\sqrt{\Delta x}} \text{sinc} [\pi (x-x_j)/\Delta x].
\end{equation}\]</div>
<p>First of all, let’s explore why these basis functions are useful. It’s best to start this discussion graphically, so let’s use some code to implement the basis and plot the basis functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>In the space below, we give you some code that defines a grid of x points and a function that implements the sinc-basis. Use these pieces of code to explore the sinc-basis functions and learn about their properties. You are looking to answer questions like the following:</p>
<ul class="simple">
<li><p>What is the value of a basis function $\phi_j$ at grid point $x_j$?</p></li>
<li><p>What is the value of a basis function $\phi_j$ at a grid point $x_{j+1}$? At $x_{j+2}$?</p></li>
<li><p>In general, how do the basis functions relate to one another?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters that we set</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Grid spacing and position-space grid points</span>
<span class="n">Delta_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">xs_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">Delta_x</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Definition of the sinc-basis functions</span>
<span class="k">def</span> <span class="nf">phi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xj</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Delta_x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">xj</span><span class="p">)</span><span class="o">/</span><span class="n">Delta_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There are two useful ways that we can look at these basis functions. First of all, we can plot an example like $\phi_3(x_j)$ to look at the $i=3$ basis function evaluated at each grid point. If we overlay this with a plot of $\phi_3(x)$ evaluated on a much finer grid, we see that the sinc-basis is defined such that a given basis function $\phi_i$ is nonzero at grid point $x_i$, and its oscillations ensure that it passes through zero at every other grid point!</p>
<p><strong>Question:</strong> Does it matter that the sinc function takes on nonzero values away from the $i\neq j$ grid points?</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs_fine</span><span class="p">,</span> <span class="n">phi</span><span class="p">(</span><span class="n">xs_fine</span><span class="p">,</span> <span class="n">xs</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$\phi_3(x)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">phi</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">xs</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$\phi_3(x_j)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Section4_v2_12_0.png" src="_images/Section4_v2_12_0.png" />
</div>
</div>
<p>It can also be useful to look at a series of these sinc functions centered at different grid points. Notice where they all pass through zero, and where each individual basis function doesn’t pass through zero.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs_fine</span><span class="p">,</span> <span class="n">phi</span><span class="p">(</span><span class="n">xs_fine</span><span class="p">,</span> <span class="n">xs</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;i=</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Section4_v2_14_0.png" src="_images/Section4_v2_14_0.png" />
</div>
</div>
<section id="interpreting-the-sinc-basis">
<h3>Interpreting the Sinc-Basis<a class="headerlink" href="#interpreting-the-sinc-basis" title="Permalink to this headline">#</a></h3>
<p><strong>Question:</strong> In light of these plots, how can we interpret the sinc-basis functions as compared to a set of Dirac delta functions?</p>
<p><strong>Answer:</strong> This is a finite resolution basis that is like the closest possible approximation to a delta function that we can make for a given range on the number of momentum basis functions that our spatial grid can accomodate. As the plots above show, we means this in the sense that these basis states satisfy</p>
<div class="amsmath math notranslate nohighlight" id="equation-cf130d56-83a6-4358-81ab-a5492c398baf">
<span class="eqno">(6)<a class="headerlink" href="#equation-cf130d56-83a6-4358-81ab-a5492c398baf" title="Permalink to this equation">#</a></span>\[\begin{equation}
\phi_j(x_k) \propto \delta_{k,j},
\end{equation}\]</div>
<p>so a given basis function only gives a nonzero contribution to a function at the point at which that basis function is centered.</p>
<p>The sinc basis has a nice relationship to the Fourier transforms that we discussed last week. In particular, the sinc basis functions can be written as follows:</p>
<div class="amsmath math notranslate nohighlight" id="equation-8e0743d5-9966-415b-bcd4-e9abe6576630">
<span class="eqno">(7)<a class="headerlink" href="#equation-8e0743d5-9966-415b-bcd4-e9abe6576630" title="Permalink to this equation">#</a></span>\[\begin{equation}
\phi_j(x) = \frac{\sqrt{\Delta x}}{2\pi} \int_{-\pi/\Delta x}^{\pi/\Delta x} e^{i k(x-x_j)} dk
\end{equation}\]</div>
<p><strong>Question:</strong> Can you justify this form qualitatively? How does it relate to Fourier transforms that we studied last week? And why are the limits on the integral those numbers?</p>
</section>
</section>
<section id="deriving-the-kinetic-energy-matrix">
<h2>Deriving the Kinetic Energy Matrix<a class="headerlink" href="#deriving-the-kinetic-energy-matrix" title="Permalink to this headline">#</a></h2>
<p>Now that we have a useful basis, we can try to solve problems with it. We still need to learn how to express the Hamiltonian in this basis. Since the Hamiltonian is</p>
<div class="amsmath math notranslate nohighlight" id="equation-2db4dfb3-42a7-4875-b6f7-98f7eeee8a9b">
<span class="eqno">(8)<a class="headerlink" href="#equation-2db4dfb3-42a7-4875-b6f7-98f7eeee8a9b" title="Permalink to this equation">#</a></span>\[\begin{equation}
H = -\frac{\hbar^2}{2m} \frac{d^2}{dx^2} + V(x)
\end{equation}\]</div>
<p>we need to figure out how to express the second derivative operator and the $V(x)$ operator in our chosen basis.</p>
<p>Let’s start with the kinetic energy term. We want to derive a kinetic energy matrix with matrix elements</p>
<div class="amsmath math notranslate nohighlight" id="equation-6f40d1cc-3ad8-464c-ba4c-fce641c381b3">
<span class="eqno">(9)<a class="headerlink" href="#equation-6f40d1cc-3ad8-464c-ba4c-fce641c381b3" title="Permalink to this equation">#</a></span>\[\begin{equation}
T_{ij} = -\frac{\hbar^2}{2m} \left \langle \phi_i \left\lvert \frac{d^2}{dx^2} \right\rvert \phi_j \right \rangle.
\end{equation}\]</div>
<p>It turns out this is where the Fourier transform expression is super helpful. We can go through the following steps:</p>
<div class="amsmath math notranslate nohighlight" id="equation-6bb1a75c-ba24-401f-9df8-2532aa94fc27">
<span class="eqno">(10)<a class="headerlink" href="#equation-6bb1a75c-ba24-401f-9df8-2532aa94fc27" title="Permalink to this equation">#</a></span>\[\begin{equation}
\int_{-\infty}^{\infty} \phi_i^\ast(x) \frac{d^2}{dx^2} \phi_j(x) dx = \frac{\Delta x}{(2\pi)^2} \int_{-\infty}^{\infty} dx \int_{-\pi/\Delta x}^{\pi/\Delta x} e^{-i k (x-x_i)} dk \int_{-\pi/\Delta x}^{\pi/\Delta x} \left( \frac{d^2}{dx^2} e^{i k' (x-x_j)} \right) dk'
\end{equation}\]</div>
<p>Because we’ve expressed the basis function in terms of plane waves, evaluating $\frac{d^2}{dx^2}$ is really easy: it just corresponds to pulling down a factor of $(ik)^2$. That gets us to</p>
<div class="amsmath math notranslate nohighlight" id="equation-c5c0b553-b2b6-4d56-8447-496edaf1cedb">
<span class="eqno">(11)<a class="headerlink" href="#equation-c5c0b553-b2b6-4d56-8447-496edaf1cedb" title="Permalink to this equation">#</a></span>\[\begin{equation}
\frac{\Delta x}{(2\pi)^2} \int_{-\pi/\Delta x}^{\pi/\Delta x} (ik)^2 e^{i k (x_i - x_j)} dk.
\end{equation}\]</div>
<p>If you work through these integrals, you will find that:</p>
<div class="amsmath math notranslate nohighlight" id="equation-371fb54b-a84d-4430-b08e-9f79a175079a">
<span class="eqno">(12)<a class="headerlink" href="#equation-371fb54b-a84d-4430-b08e-9f79a175079a" title="Permalink to this equation">#</a></span>\[\begin{equation}
\boxed{T_{i,j=i} = \frac{\hbar^2}{2m \Delta x^2} \frac{\pi^2}{3}}
\end{equation}\]</div>
<p>and</p>
<div class="amsmath math notranslate nohighlight" id="equation-ad71e8bf-aabd-451b-8263-27c9f56da31b">
<span class="eqno">(13)<a class="headerlink" href="#equation-ad71e8bf-aabd-451b-8263-27c9f56da31b" title="Permalink to this equation">#</a></span>\[\begin{equation}
\boxed{T_{i,j \neq i} = \frac{\hbar^2}{2m \Delta x^2} \frac{2 (-1)^{i-j}}{(i-j)^2}}
\end{equation}\]</div>
<p><strong>Task:</strong> Now fill in the code below to make a function that builds the kinetic energy operator and the potential energy operator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># work in some convenient units</span>
<span class="n">hbar</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to make the kinetic energy operator</span>
<span class="k">def</span> <span class="nf">make_T</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">Delta_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Tmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
    
    <span class="c1"># now loop over kinetic energy matrix and fill in matrix elements</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">:</span>
                <span class="n">Tmat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hbar</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">Delta_x</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Tmat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hbar</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">Delta_x</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                
    <span class="k">return</span> <span class="n">Tmat</span>
  
</pre></div>
</div>
</div>
</div>
</section>
<section id="deriving-the-potential-energy-matrix">
<h2>Deriving the Potential Energy Matrix<a class="headerlink" href="#deriving-the-potential-energy-matrix" title="Permalink to this headline">#</a></h2>
<p>For the potential energy matrix, we need to express $V(x)$ in matrix form. Since $V(x)$ can be expanded as a power series in the position operator $\hat{x}$, let’s first look at the matrix form of $\hat{x}$ itself. We want the matrix elements $x_{ij} = \langle \phi_i | x | \phi_j \rangle$. In other words, we want</p>
<div class="amsmath math notranslate nohighlight" id="equation-dc5dbfcd-bf9b-4aea-8fc2-609cc9374597">
<span class="eqno">(14)<a class="headerlink" href="#equation-dc5dbfcd-bf9b-4aea-8fc2-609cc9374597" title="Permalink to this equation">#</a></span>\[\begin{equation}
\int_{-\infty}^{\infty} \phi_i(x)^\ast x \phi_j(x) dx = \frac{\Delta x}{(2\pi)^2} \int_{-\pi/\Delta x}^{\pi/\Delta x} dk \int_{-\pi/\Delta x}^{\pi/\Delta x} dk' e^{ikx_i - ik'x_j} \int_{-\infty}^{\infty} x e^{i x (k'-k)} dx.
\end{equation}\]</div>
<p>In the last term, note that we can replace $x$ by $\frac{d}{d(ik’)}$ and then pull the derivative outside of the integral over $x$ (since it doesn’t depend on $x$ anymore).  Working through the integrals after that step, we get to</p>
<div class="amsmath math notranslate nohighlight" id="equation-069c3e0e-4ea5-4257-8621-8e9ab55d8606">
<span class="eqno">(15)<a class="headerlink" href="#equation-069c3e0e-4ea5-4257-8621-8e9ab55d8606" title="Permalink to this equation">#</a></span>\[\begin{equation}
x_{ij} = \frac{\Delta x}{2\pi} x_i \int_{-\pi/\Delta x}{\pi/\Delta x} dk' e^{ik'(x_i-x_j)} = x_i \delta_{i,j}.
\end{equation}\]</div>
<p><strong>The important conclusion is that $\hat{x}$ is diagonal in this basis!</strong> So the potential energy, which can be expanded in powers of $x$ is also diagonal in this basis! Knowing this, we can just make the potential energy operator by building a diagonal matrix from $V(x)$. The function <code class="docutils literal notranslate"><span class="pre">make_V</span></code> does this, and then the function <code class="docutils literal notranslate"><span class="pre">make_H</span></code> just calls the kinetic and potential energy functions and puts them together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to make the potential energy operator</span>
<span class="k">def</span> <span class="nf">make_V</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Vfunc</span><span class="p">):</span>
    <span class="n">Vmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Vfunc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Vmat</span>

<span class="c1"># Function to make the full Hamiltonian</span>
<span class="k">def</span> <span class="nf">make_H</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Vfunc</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">make_T</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">make_V</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Vfunc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="testing-the-dvr-code">
<h2>Testing the DVR code<a class="headerlink" href="#testing-the-dvr-code" title="Permalink to this headline">#</a></h2>
<p>That was a lot of work to get our Hamiltonian matrix. But now let’s see the payoff! We’ll see that the DVR code is incredibly accurate, especially compared to the finite differences method that we used before. As always let’s test our code by using a harmonic oscillator potential. Let’s start with a 20 point grid and see how the calculations do for energies and wavefunctions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Vharmonic</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ham</span> <span class="o">=</span> <span class="n">make_H</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">Vharmonic</span><span class="p">)</span>
<span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">Ham</span><span class="p">)</span>
<span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.50042652, 1.49199271, 2.54377448, 3.30864454])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">vecs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fdb1af5e8e0&gt;,
 &lt;matplotlib.lines.Line2D at 0x7fdb1af5e910&gt;,
 &lt;matplotlib.lines.Line2D at 0x7fdb1af5ea30&gt;]
</pre></div>
</div>
<img alt="_images/Section4_v2_35_1.png" src="_images/Section4_v2_35_1.png" />
</div>
</div>
<p>Let’s look at the accuracy of our solutions as a function of quantum number.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">Nlist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nlist</span><span class="p">)):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mi">20</span><span class="o">/</span><span class="n">Nlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">Nlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">Ham</span> <span class="o">=</span> <span class="n">make_H</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">Vharmonic</span><span class="p">)</span>
    <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">Ham</span><span class="p">)</span>
    <span class="n">energies_exact</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span> <span class="o">-</span> <span class="n">energies_exact</span><span class="p">)</span><span class="o">/</span><span class="n">energies_exact</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">])</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">Nlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nlist</span><span class="p">))])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Quantum number, n&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Fractional error&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Fractional error&#39;)
</pre></div>
</div>
<img alt="_images/Section4_v2_37_1.png" src="_images/Section4_v2_37_1.png" />
</div>
</div>
<p><strong>Question:</strong> Explain the differences between the case with 50 grid points and the case with 60 grid points. Why is the agreement better to higher $n$ for 60 grid points? Also, why does the agreement seem to always get worse above $n \sim 25$, even if the number of grid points is increased?</p>
<section id="comparing-dvr-to-finite-differences">
<h3>Comparing DVR to Finite Differences<a class="headerlink" href="#comparing-dvr-to-finite-differences" title="Permalink to this headline">#</a></h3>
<p>Let’s look at the accuracy of the numerical solution as a function of the number of grid points. We can compare this to the results of HW 1 to see how the DVR method does against finite differences.</p>
<p>In this block, write a function that computes the fractional error in the SHO eigenstates as a function of the number of grid points used.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">errorlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nlist</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nlist</span><span class="p">)):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">Nlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="o">/</span><span class="n">Nlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">make_H</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">Vharmonic</span><span class="p">)</span>
    <span class="n">evals</span><span class="p">,</span> <span class="n">evecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
    <span class="n">errorlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
</div>
<p>This next block is already written for you– nothing you need to do!— to implement and solve the same problem using the Numerov method. The code is taken from the HW1 solutions.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to make the A matrix:</span>
<span class="k">def</span> <span class="nf">makeA</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">h</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># fill in diagonal</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># the first row looks like [-2,1,0,0,0...]/h^2</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">i</span><span class="o">==</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># the last row looks like [...,0,0,1,-2]/h^2</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># all other rows look like [...0,1,-2,1,0,...]/h^2</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">A</span>

<span class="c1"># Function to make the B matrix:</span>
<span class="k">def</span> <span class="nf">makeB</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.0</span><span class="o">/</span><span class="mi">12</span> <span class="c1"># fill in diagonal</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span>
        <span class="k">elif</span> <span class="n">i</span><span class="o">==</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span>
            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span>
    <span class="k">return</span> <span class="n">B</span>

<span class="c1"># Function to make the Hamiltonian matrix on a grid of N points between (xmin,xmax), then find eigenvalues/eigenvectors.</span>
<span class="c1"># The potential energy Vfunc is an arbitrary function that gets passed in and discretized inside of this function.</span>
<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">Vfunc</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="c1"># grid of x values</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># grid spacing</span>

    <span class="c1"># make the A and B matrices</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">makeA</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">makeB</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">Tmat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">@</span> <span class="n">A</span> <span class="c1"># This is the matrix representing kinetic energy.</span>

    <span class="c1"># put the potential energy onto a grid and then put that into a diagonal matrix</span>
    <span class="n">Vgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">Vgrid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vfunc</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">Vmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Vgrid</span><span class="p">)</span>

    <span class="c1"># Finally we get the whole Hamiltonian</span>
    <span class="n">Hmat</span> <span class="o">=</span> <span class="n">Tmat</span> <span class="o">+</span> <span class="n">Vmat</span>

    <span class="c1"># Now diagonalize the Hamiltonian. </span>
    <span class="c1"># eigh returns sorted values and vectors!</span>
    <span class="n">evals</span><span class="p">,</span> <span class="n">evecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">Hmat</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">evals</span><span class="p">,</span> <span class="n">evecs</span>

<span class="c1"># NOW ACTUALLY CALL THE NUMEROV METHOD</span>
<span class="n">vals_numerov</span><span class="p">,</span> <span class="n">vecs_numerov</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="n">Vharmonic</span><span class="p">)</span>
<span class="n">errorlist_numerov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nlist</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nlist</span><span class="p">)):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">Nlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">vals_num</span><span class="p">,</span> <span class="n">vecs_num</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">Vharmonic</span><span class="p">)</span>
    <span class="n">errorlist_numerov</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals_num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
</div>
<p>Now, make a plot of the relative errors comparing the numerov and DVR methods for the ground state as a function of the grid spacing $\Delta x$.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">([</span><span class="mi">20</span><span class="o">/</span><span class="n">Nlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nlist</span><span class="p">))],</span><span class="n">errorlist</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DVR method&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">([</span><span class="mi">20</span><span class="o">/</span><span class="n">Nlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nlist</span><span class="p">))],</span><span class="n">errorlist_numerov</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Numerov method&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Fractional error&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Fractional error&#39;)
</pre></div>
</div>
<img alt="_images/Section4_v2_46_1.png" src="_images/Section4_v2_46_1.png" />
</div>
</div>
<p>Clearly the DVR method is much better than the Numerov technique! For reasonable grid sizes, the DVR method gets the ground-state energy with almost 10 orders of magnitude better relative agreement!! (And remember, the Numerov method was already much better than a “plain” second-order finite differences approximation to the Hamiltonian…)</p>
<p><strong>Question:</strong> Why do you think the DVR method stops getting more accurate at a certain step size? What does this tell you about setting up simulations?</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="home.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Welcome to QSE 200!</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Section6_v2.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Section 6: An Intuitive Picture of Band Structure</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ben Augenbraun<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>